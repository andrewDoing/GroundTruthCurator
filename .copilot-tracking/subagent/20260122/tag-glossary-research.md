# Tag Glossary Research

**Date:** 2026-01-22
**Topic:** tag-glossary

## Summary

The system has a well-designed tag architecture with clear separation between **manual tags** (user-editable) and **computed tags** (auto-generated). However, there is **no existing infrastructure for tag definitions, descriptions, or a glossary**. Tags are stored as simple strings without metadata.

---

## 1. Current Tag System Overview

### Manual Tags

Manual tags are user-editable and stored in the `manualTags` field on ground truth items. Default manual tags are configured via JSON file.

**Location:** [backend/app/domain/manual_tags.json](backend/app/domain/manual_tags.json)

**Current Manual Tag Groups:**

| Group | Exclusive | Values |
|-------|-----------|--------|
| source | Yes | sme, sa, synthetic, sme_curated, user, other |
| answerability | Yes | answerable, not_answerable, should_not_answer |
| topic | No | general, compatibility, install, license, performance, security |
| intent | No | informational, action, feedback, clarification, other |
| expertise | Yes | expert, novice |
| difficulty | Yes | easy, medium, hard |

### Computed Tags

Computed tags are auto-generated by plugins and stored in `computedTags` field. They are read-only in the UI.

**Plugin Location:** [backend/app/plugins/computed_tags/](backend/app/plugins/computed_tags/)

**Current Computed Tag Plugins:**

| Plugin | Tag Key | Description (from code comments) |
|--------|---------|----------------------------------|
| DatasetPlugin | `dataset:_dynamic` | Tags documents with their dataset name |
| QuestionLengthShortPlugin | `question_length:short` | Questions with â‰¤10 words |
| QuestionLengthMediumPlugin | `question_length:medium` | Questions with 11-30 words |
| QuestionLengthLongPlugin | `question_length:long` | Questions with >30 words |
| SingleTurnPlugin | `turns:singleturn` | Documents with no/minimal history |
| MultiTurnPlugin | `turns:multiturn` | Documents with >2 history turns |
| NoAnswerPlugin | `answer:no_answer` | Ground truth answer is "NO_ANSWER" |
| RetrievalBehaviorNoRefsPlugin | `retrieval_behavior:no_refs` | Zero references |
| RetrievalBehaviorSinglePlugin | `retrieval_behavior:single` | Exactly one reference |
| RetrievalBehaviorTwoRefsPlugin | `retrieval_behavior:two_refs` | Exactly two references |
| RetrievalBehaviorRichPlugin | `retrieval_behavior:rich` | Three or more references |
| ReferenceTypeArticlePlugin | `reference_type:article` | Contains CS# pattern URL |
| ReferenceTypeHelpcenterPlugin | `reference_type:helpcenter` | Contains /help URL |

---

## 2. Tag Definition Storage

### Current State

- **Manual Tags:** Stored in JSON config ([manual_tags.json](backend/app/domain/manual_tags.json)) with only `group`, `tags`, and `mutuallyExclusive` fields
- **Computed Tags:** Defined in Python plugin classes with descriptions only in docstrings
- **No description/definition field** exists in any tag model
- **No glossary endpoint** or UI exists

### Key Files

| Purpose | Location |
|---------|----------|
| Manual tag config | [backend/app/domain/manual_tags.json](backend/app/domain/manual_tags.json) |
| Manual tag provider | [backend/app/domain/manual_tags_provider.py](backend/app/domain/manual_tags_provider.py) |
| Tag schema & rules | [backend/app/domain/tags.py](backend/app/domain/tags.py) |
| Tag API endpoints | [backend/app/api/v1/tags.py](backend/app/api/v1/tags.py) |
| Computed tag base | [backend/app/plugins/base.py](backend/app/plugins/base.py) |
| Plugin registry | [backend/app/plugins/registry.py](backend/app/plugins/registry.py) |

---

## 3. UI Tag Display

### Components

| Component | Location | Purpose |
|-----------|----------|---------|
| TagChip | [frontend/src/components/common/TagChip.tsx](frontend/src/components/common/TagChip.tsx) | Display individual tag with computed vs manual styling |
| TagsEditor | [frontend/src/components/app/editor/TagsEditor.tsx](frontend/src/components/app/editor/TagsEditor.tsx) | Add/remove manual tags, display computed tags (read-only) |
| InspectItemModal | [frontend/src/components/modals/InspectItemModal.tsx](frontend/src/components/modals/InspectItemModal.tsx) | Shows tags in item inspection view |

### Tag Service

[frontend/src/services/tags.ts](frontend/src/services/tags.ts) provides:
- `fetchTagSchema()` - Get tag groups with exclusive rules
- `fetchTagsWithComputed()` - Get manual and computed tags separately
- `validateExclusiveTags()` - Validate exclusive group rules
- `addTags()` - Add new manual tags to global registry

### Current UI Behavior

1. **Computed tags:** Displayed with lock icon and slate color scheme; read-only
2. **Manual tags:** Displayed with violet color scheme; removable with X button
3. **TagsEditor:** Shows "Auto-generated" label for computed tags section
4. **No tooltips or definitions** are displayed for any tags

---

## 4. API Endpoints

| Endpoint | Purpose |
|----------|---------|
| `GET /v1/tags/schema` | Returns tag groups with values and exclusive rules |
| `GET /v1/tags` | Returns `{ tags: [...], computedTags: [...] }` |
| `POST /v1/tags` | Add tags to global registry |
| `DELETE /v1/tags` | Remove tags from global registry |

### Schema Response Shape

```typescript
interface TagSchemaResponse {
  version: string;  // "v1"
  groups: Array<{
    name: string;
    values: string[];
    exclusive: boolean;
    depends_on: Array<{ group: string; value: string }>;
  }>;
}
```

**Note:** No `description` field exists in the schema response.

---

## 5. Gaps for Glossary Feature

### Missing Infrastructure

| Gap | Description | Impact |
|-----|-------------|--------|
| No description field in manual tag config | JSON only has group/tags/exclusive | Cannot store manual tag definitions |
| No metadata in ComputedTagPlugin | Only `tag_key` and `compute()` | Computed tag descriptions only in docstrings |
| No glossary API endpoint | No way to fetch all tag definitions | Frontend cannot display definitions |
| No UI for viewing definitions | Tags displayed without context | Users don't know what tags mean |
| No UI for managing definitions | No admin interface | Definitions cannot be edited |

### Required Changes

#### Backend

1. **Extend manual tag JSON schema:**
   ```json
   {
     "group": "source",
     "description": "Where the ground truth originated",
     "tags": [
       { "value": "sme", "description": "Created by subject matter expert" },
       { "value": "synthetic", "description": "AI-generated content" }
     ]
   }
   ```

2. **Add metadata to ComputedTagPlugin:**
   ```python
   class ComputedTagPlugin(ABC):
       @property
       @abstractmethod
       def tag_key(self) -> str: ...

       @property
       @abstractmethod
       def description(self) -> str:
           """Human-readable description for glossary."""
           ...
   ```

3. **Create glossary API endpoint:**
   - `GET /v1/tags/glossary` returning all tags with definitions
   - Merge manual tag definitions with computed tag descriptions

#### Frontend

1. **TagChip enhancement:** Add tooltip with tag definition on hover
2. **Glossary component:** Full-page or modal view of all tag definitions
3. **TagsEditor enhancement:** Show definition when selecting tags
4. **Admin UI (optional):** Allow editing manual tag definitions

---

## 6. Design Recommendations

### Minimal Viable Glossary

1. Add `description` field to manual tag JSON (backward compatible)
2. Add `description` property to `ComputedTagPlugin` base class
3. Create `GET /v1/tags/glossary` endpoint merging both sources
4. Add tooltips to `TagChip` component showing definitions

### Full Glossary Feature

1. All above plus:
2. Dedicated glossary page/modal in UI
3. Admin interface for managing definitions
4. Consider storing definitions in database for runtime updates

---

## References

- [Computed Tags Design](docs/computed-tags-design.md) - Full architecture
- [Manual Tags Design](docs/manual-tags-design.md) - Provider pattern and validation
